function buildGraph(e){var o=.7*Math.max(document.documentElement.clientHeight,window.innerHeight||0);document.documentElement.clientHeight<900&&(o=.85*o),$("#graph2").css("height",o+"px"),$("#graph2").css("cursor","move");var a=!1;$("#provShuffle").addClass("disabled");var r={nodes:[],edges:[]},t=new sigma({graph:r,container:"graph2",renderer:{container:document.getElementById("graph2"),type:"canvas"},settings:{doubleClickEnabled:!1,sideMargin:2,zoomMin:zoomMin,zoomMax:zoomMax,minNodeSize:4*(o/475),maxNodeSize:14*(o/450),defaultLabelColor:"#000",defaultLabelHoverColor:"#eee",defaultHoverLabelBGColor:"#333",labelSizeRatio:"1.25",labelThreshold:12,minEdgeSize:2,maxEdgeSize:2,minArrowSize:1,edgeLabelSize:"proportional"}}),n=($("#inverted").val(),baseURI+"/prov/data2");n+="?roots="+e+"&inverted=true&travelUp=true&d=1",sigma.parsers.json(n,t,function(){var o,r=t.graph.nodes(),n=t.graph.edges(),d=r.length;for(o=0;o<n.length;o++)edge=n[o],edge.color=edgeColor,edge.type="arrow",edge.size=2;for(o=0;d>o;o++){var i=r[o];i.x=Math.random(),i.y=Math.random();t.graph.degree(i.id,"out"),t.graph.degree(i.id,"in");switch(i.nodeType){case 0:i.type="circle";break;case"0":i.type="circle";break;case 1:i.type="square";break;case"1":i.type="square";break;case 2:i.type="diamond";break;case"2":i.type="diamond"}"true"===i.isCodebook&&(i.type="equilateral",i.label+=" (codebook)"),i.size=3,i.id==e?(i.expanded=!0,i.color=nodeColor):(i.expanded=!1,i.color=nodeColorLeaf),$("#nodeFilterList option[value='"+i.id+"']").length<1&&$("#nodeFilterList").append('<option value="'+i.id+'">'+i.label+"</option>")}a&&$("#nodeFilterList option[value='"+root2+"']").prop("selected",!0),$("#graph2 h2").remove(),t.refresh(),faConfig={barnesHutOptimize:!0,barnesHutTheta:.75,linLogMode:!0,adjustSizes:!1,edgeWeightInfluence:20,scalingRatio:4,strongGravityMode:!0,gravity:1,slowDown:1e3},faConfig2={linLogMode:!1,adjustSizes:!0,edgeWeightInfluence:10,scalingRatio:1,strongGravityMode:!1,gravity:0,slowDown:1e5},faConfig3={barnesHutOptimize:!0,barnesHutTheta:.5,linLogMode:!0,adjustSizes:!0,edgeWeightInfluence:10,scalingRatio:1,strongGravityMode:!0,gravity:1,slowDown:50},t.configForceAtlas2(faConfig),t.startForceAtlas2(),setTimeout(function(){graphBuilt=!0,t.stopForceAtlas2(),t.killForceAtlas2(),$("#provShuffle").removeClass("disabled"),t.bind("overNode outNode",function(e){"overNode"===e.type?$("#graph2").css("cursor","pointer"):$("#graph2").css("cursor","move")});var e;t.bind("clickNode",function(o){e=select(t,o)});var o,a=!1;$(document).keydown(function(e){81!=e.keyCode||a||(a=!0,o=setInterval(function(){rotate(t,.01)},5))}).keyup(function(){clearInterval(o),o=null,a=!1});var r;$(document).keydown(function(e){69!=e.keyCode||a||(a=!0,r=setInterval(function(){rotate(t,-.01)},5))}).keyup(function(){clearInterval(r),r=null,a=!1});var n=!1;$("#provCluster").mousedown(function(){n||(t.configForceAtlas2(faConfig3),t.startForceAtlas2())}).mouseup(function(){t.stopForceAtlas2(),t.killForceAtlas2(),n=!1}).mouseout(function(){t.stopForceAtlas2(),t.killForceAtlas2(),n=!1})},750)})}function shuffle(){$("#provShuffle").click(function(){$("#graph2").empty(),$("#graph2Info").empty(),$("#graph2Info").css("padding","0em"),buildGraph(startingRoot)})}function rotate(e,o){var a=e.camera.angle,r=e.camera.ratio,t=e.camera.x,n=e.camera.y,d=100;n>1?n-=n/d:-1>n?n-=n/d:n=0,t>1?t-=t/d:-1>t?t-=t/d:t=0,e.camera.goTo({x:t,y:n,angle:a+o,ratio:r})}function moveToNode(e,o){e.camera.goTo({x:o["read_cam0:x"],y:o["read_cam0:y"]})}function select(e,o){viewingSubset=!viewingSubset;var a=o.data.node.id,r=0;selectedNode!=o.data.node.id&&null!==selectedNode&&(viewingSubset=!0,resetGraph(e));var t=viewingSubset;o.data.node.expanded||($.ajax({cache:!1,async:!1,type:"GET",url:baseURI+"/prov/data2?roots="+a+"&inverted=true&travelUp=true&d=1",complete:function(t){if(t.status<400){var n=JSON.parse(t.responseText),d=n.nodes,i=n.edges;for(var l in d){var s=d[l];if(s.id!=a&&null===e.graph.nodes(s.id)){++r;var c=o.data.node["read_cam0:size"],g=o.data.node.x+c*-.125,u=o.data.node.x+.125*c,p=o.data.node.y+c*-.125,f=o.data.node.y+.125*c,h=Math.random()*(u-g)+g,v=Math.random()*(f-p)+p;e.graph.addNode({id:s.id,label:s.label,uri:s.uri,date:s.date,expanded:!1,nodeType:s.nodeType,x:h,y:v,size:o.data.node.size,color:nodeColorLeaf})}}for(var m in i){var b=i[m];null===e.graph.edges(b.id)&&e.graph.addEdge({id:b.id,source:b.source,target:b.target,edgeType:b.edgeType,color:edgeColor,type:"arrow",size:2})}}}}),o.data.node.expanded=!0);var n=r>0?faConfig:faConfig2,d=500;return t?(selectedNode=a,o.data.node.color=selectColor,drawInfoBox(e,o),redraw(e,n,d),o):(selectedNode=null,o.data.node.color=nodeColor,resetGraph(e),redraw(e,n,d),null)}function redraw(e,o,a){e.configForceAtlas2(o),e.startForceAtlas2(),setTimeout(function(){e.stopForceAtlas2(),e.killForceAtlas2()},a)}function drawInfoBox(e,o){o.data.node.color=selectColor;var a="ID: "+o.data.node.id;a+="<br /> Label: "+o.data.node.label;var r="";if(null!==o.data.node.uri){var t=o.data.node.uri;r="URI: <a href='"+t+"' target='_blank'>"+t+"</a>"}else r="URI: none";switch(a+="<br />"+r,o.data.node.nodeType){case 0:a+="<br /> Type: Entity";break;case"0":a+="<br /> Type: Entity";break;case 1:a+="<br /> Type: Agent";break;case"1":a+="<br /> Type: Agent";break;case 2:a+="<br /> Type: Activity";break;case"2":a+="<br /> Type: Activity"}a+="<br /><a href='"+baseURI+"/edit/prov/"+o.data.node.id+"'>Edit node</a>",a="<p>"+a+"</p>",$("#graph2Info").html(a),$("#graph2Info").css("padding","0.5em 1em")}function resetGraph(e){var o=e.graph.nodes(),a=e.graph.edges();for(i=0;i<a.length;i++)a[i].color=edgeColor;for(i=0;i<o.length;i++){var r=o[i];e.graph.degree(r.id,"out"),e.graph.degree(r.id,"in");r.hidden=!1,r.expanded?r.color=nodeColor:r.color=nodeColorLeaf}$("#graph2Info").empty(),$("#graph2Info").css("padding","0em")}var viewingSubset=!1,selectedNode=null,startingRoot,zoomMin=.1,zoomMax=1.5,selectColor="#ca4642",nodeColor="#2a6496",nodeColorLeaf="rgba(42,100,150,0.5)",nodeNullURIColor="#333",nodeDisconnectColor="rgba(42,100,150,0.25)",edgeColor="rgba(155,155,155,0.75)",outColor="#d91616",inColor="#00d093",srColor="#d97816";$(document).ready(function(){startingRoot=$("#startingNode").val(),$("#graph2").html("<h2>Loading...</h2>"),graphBuilt=!1,lastProvS="",baseURI=$("#meta_uri").html(),buildGraph(startingRoot),shuffle()});