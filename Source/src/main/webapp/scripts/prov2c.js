function graphMouseOver(){$("#graph2").mouseenter(function(){$(this).css("border","1px solid #428bca")}).mouseleave(function(){$(this).css("border","1px solid #ddd")})}function buildGraph(){$("#graph2").html("<h2>Loading...</h2>"),$("#workflowView").html("<h2>Details</h2>"),viewingSubset?$("#workflowView").css("visibility","inherit"):$("#workflowView").css("visibility","hidden");var e=$("#main").height(),o=.7*Math.max(document.documentElement.clientHeight,window.innerHeight||0);document.documentElement.clientHeight<900&&(o=.85*o),o>.95*e&&(o=.95*e),$("#graph2").css("height",o+"px"),$("#graph2").css("cursor","move");$(graph2).width();$("#provShuffle").addClass("disabled");var t={nodes:[],edges:[]},n=new sigma({graph:t,container:"graph2",renderer:{container:document.getElementById("graph2"),type:"canvas"},settings:{doubleClickEnabled:!1,sideMargin:3,zoomMax:zoomMax,zoomMin:zoomMin,minNodeSize:4*(o/475),maxNodeSize:20*(o/450),defaultLabelColor:"#000",defaultLabelHoverColor:"#eee",defaultHoverLabelBGColor:"#333",labelSizeRatio:"1.25",labelThreshold:10,minEdgeSize:0,maxEdgeSize:0}}),a=$("#inverted").val(),r=baseURI+"/prov/data2",i=2;null!==selectedNode?(r+="?roots="+selectedNode,null!==a&&""!==a&&(r+="&inverted=true&travelUp=true&d="+i)):null!==a&&""!==a&&(r+="?inverted=true&d="+i),sigma.parsers.json(r,n,function(){var e,o=n.graph.nodes(),t=n.graph.edges(),a=o.length;for(e=0;e<t.length;e++){var r=t[e];r.color="#ccc",r.type="curvedArrow",r.size=2}for(e=0;a>e;e++){var l=o[e],d=n.graph.degree(l.id,"out"),s=n.graph.degree(l.id,"in");switch(l.nodeType){case 0:l.type="circle";break;case"0":l.type="circle";break;case 1:l.type="square";break;case"1":l.type="square";break;case 2:l.type="diamond";break;case"2":l.type="diamond"}"true"===l.isCodebook&&(l.type="equilateral",l.label+=" (codebook)");var c=3*d;l.x=Math.random(),l.y=Math.random(),l.id==selectedNode?(l.color="#ff4000",0===c&&(c=1),l.size=4*c):(s>0||d>0?l.color="#2a6496":l.color="rgba(42,100,150,.25)",l.size=c),$("#nodeFilterList option[value='"+l.id+"']").length<1&&($("#nodeFilterList").append('<option value="'+l.id+'">'+l.label+"</option>"),$("#inputSelector").append('<option value="'+l.id+'">'+l.label+"</option>"))}$("#graph2 h2").remove(),n.refresh(),$("#nodeCount").remove(),viewingSubset?($("#node_"+selectedNode).insertAfter("#workflowView h2"),1==a?$("#provSmall").append("<p id='nodeCount'>Viewing a single unnconnected node</p>"):$("#provSmall").append("<p id='nodeCount'>Viewing nodes with in "+i+" hops of node '"+selectedNode+"'("+a+" nodes total selected)</p>"),$("#nodeCount").append(" <br /><a href='"+baseURI+"/edit/prov/"+selectedNode+"'>Edit this node</a>")):$("#provSmall").append("<p id='nodeCount'>Click on a node to view details</p>"),faConfig={barnesHutOptimize:!0,barnesHutTheta:.75,linLogMode:!0,adjustSizes:!1,edgeWeightInfluence:20,scalingRatio:4,strongGravityMode:!0,gravity:0,slowDown:1e3},n.configForceAtlas2(faConfig),n.startForceAtlas2(),setTimeout(function(){graphBuilt=!0,n.stopForceAtlas2(),n.killForceAtlas2(),$("#nodeFilterList").chosen(),$("#provShuffle").removeClass("disabled"),n.bind("overNode outNode",function(e){"overNode"===e.type?$("#graph2").css("cursor","pointer"):$("#graph2").css("cursor","move")});var e;n.bind("clickNode",function(o){e=select(n,o,!1)});var o,t=!1;$("#provRotateCCW").mousedown(function(){t||(t=!0,o=setInterval(function(){rotate(n,.01)},5))}).mouseup(function(){clearInterval(o),o=null,t=!1}).mouseout(function(){clearInterval(o),o=null,t=!1});var a;$("#provRotateCW").mousedown(function(){t||(t=!0,a=setInterval(function(){rotate(n,-.01)},5))}).mouseup(function(){clearInterval(a),a=null,t=!1}).mouseout(function(){clearInterval(a),a=null,t=!1});var r,i=!1;$("#provZoomIn").mousedown(function(){i||(i=!0,r=setInterval(function(){zoom(n,.98)},5))}).mouseup(function(){clearInterval(r),r=null,i=!1}).mouseout(function(){clearInterval(r),r=null,i=!1}),$("#provZoomOut").mousedown(function(){i||(i=!0,r=setInterval(function(){zoom(n,1.02)},5))}).mouseup(function(){clearInterval(r),r=null,i=!1}).mouseout(function(){clearInterval(r),r=null,i=!1})},750)})}function zoom(e,o){var t=e.camera.x,n=e.camera.y,a=e.camera.a,r=e.camera.ratio;zoomMax>=r*o&&r*o>=zoomMin&&(r*=o),e.camera.goTo({x:t,y:n,angle:a,ratio:r})}function shuffle(){$("#nodeFilterList").change(function(){"--Show All Nodes--"!==$("#nodeFilterList").val()&&null!==$("#nodeFilterList").val()?(viewingSubset=!0,selectedNode=$("#nodeFilterList").val()):(viewingSubset=!1,selectedNode=null),redraw()}),$("#provShuffle").click(function(){redraw()})}function redraw(){$("#graph2").empty(),$("#graph2Info").empty(),$("#graph2Info").css("padding","0em"),buildGraph()}function rotate(e,o){var t=e.camera.angle,n=e.camera.ratio,a=e.camera.x,r=e.camera.y,i=150;r>1?r-=r/i:-1>r?r-=r/i:r=0,a>1?a-=a/i:-1>a?a-=a/i:a=0,e.camera.goTo({x:a,y:r,angle:t+o,ratio:n})}function moveToNode(e,o){var t=o.size/7;t>1?t=1:.5>t&&(t=.5),e.camera.goTo({x:o["read_cam0:x"],y:o["read_cam0:y"],ratio:t})}function select(e,o,t){$("#nodeCount").remove();var n=(e.graph.nodes(),e.graph.edges(),o.data.node.id);return viewingSubset=!viewingSubset,selectedNode!=n||viewingSubset?(selectedNode!==n?(selectedNode=n,viewingSubset=!0):selectedNode=n,$("#nodeFilterList option").each(function(){$(this).val()==n&&$(this).attr("selected","selected")})):(selectedNode=null,$("#nodeFilterList option:first").attr("selected","selected")),redraw(),null}var viewingSubset=!1,selectedNode=null,zoomMin=.1,zoomMax=1.5,baseURI=$("#meta_uri").html();$(document).ready(function(){$("#graph2").html("<h2>Loading...</h2>"),graphBuilt=!1,baseURI=$("#meta_uri").html(),buildGraph(),shuffle(),graphMouseOver()});