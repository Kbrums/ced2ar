function buildGraph(){graphBuilt=!1;var e=.7*Math.max(document.documentElement.clientHeight,window.innerHeight||0);document.documentElement.clientHeight<900&&(e=.85*e),$("#graph2").css("height",e+"px"),$("#graph2").css("cursor","move"),$("#provShuffle").addClass("disabled");var o={nodes:[],edges:[]};s=new sigma({graph:o,container:"graph2",renderer:{container:document.getElementById("graph2"),type:"canvas"},settings:{doubleClickEnabled:!1,sideMargin:2,zoomMin:zoomMin,zoomMax:zoomMax,minNodeSize:4*(e/475),maxNodeSize:12*(e/450),defaultLabelColor:"#000",defaultLabelHoverColor:"#eee",defaultHoverLabelBGColor:"#333",defaultNodeBorderColor:"rgba(0,0,0,.9)",defaultEdgeLabelColor:"#000",defaultEdgeLabelActiveColor:"#000",defaultEdgeLabelSize:$("#edgeLabelToggle").prop("checked")?6:0,edgeLabelSizePowRatio:2,edgeLabelThreshold:3,edgeLabelSize:"proportional",labelSizeRatio:"1.25",labelThreshold:8,minEdgeSize:1,maxEdgeSize:5}});var a=$("#startingNode").val();drawGraph(a,faConfig,2,!0)}function drawGraph(e,o,a,r){var n=0;$.ajax({cache:!1,async:!1,type:"GET",url:baseURI+"/prov/data3?start="+e+"&depth="+a,complete:function(a){if(a.status<400){var r=JSON.parse(a.responseText).results[0].data;for(var t in r){var d;graphBuilt&&(d=s.graph.nodes(e));var i=r[t].graph.nodes,l=r[t].graph.relationships;for(var g in i){var c=0,h=0;if(graphBuilt){var p=d.size,u=d.x+p*-.125,f=d.x+.125*p,m=d.y+p*-.125,v=d.y+.125*p;c=Math.random()*(f-u)+u,h=Math.random()*(v-m)+m}else c=Math.random(),h=Math.random();n+=addNode(i[g],e,c,h)}for(var b in l)addEdge(l[b])}}0===n&&(o=faConfig2)}});var t=s.graph.nodes();for(var d in t){var i=t[d];switch(i.nodeType){case"text":i.size=.75*s.graph.degree(i.id,"in");break;default:i.size=.5*s.graph.degree(i.id,"out")+.5*s.graph.degree(i.id,"in")}}var l=s.graph.edges();for(var g in l){var c=l[g],h=s.graph.degree(c.target,"in"),p=h/2,u="rgba(200,200,200,"+h/5+")";c.size=p,c.color=u}s.graph.nodes(e).expanded=!0,s.refresh(),s.configForceAtlas2(o),s.startForceAtlas2(),setTimeout(function(){if(graphBuilt=!0,s.stopForceAtlas2(),s.killForceAtlas2(),$("#provShuffle").removeClass("disabled"),toggleEdgeLabels(),r){s.bind("overNode outNode",function(e){"overNode"===e.type?$("#graph2").css("cursor","pointer"):$("#graph2").css("cursor","move")}),s.bind("clickNode",function(e){select(e)});var e,o=!1;$(document).keydown(function(a){69!=a.keyCode||o||(o=!0,e=setInterval(function(){rotate(-.01)},5))}).keyup(function(){clearInterval(e),e=null,o=!1});var a;$(document).keydown(function(e){81!=e.keyCode||o||(o=!0,a=setInterval(function(){rotate(.01)},5))}).keyup(function(){clearInterval(a),a=null,o=!1});var n=!1;$("#provCluster").mousedown(function(){n||(s.configForceAtlas2(faConfig3),s.startForceAtlas2())}).mouseup(function(){s.stopForceAtlas2(),s.killForceAtlas2(),n=!1}).mouseout(function(){s.stopForceAtlas2(),s.killForceAtlas2(),n=!1})}},750)}function rotate(e){var o=s.camera.angle,a=s.camera.ratio,r=s.camera.x,n=s.camera.y,t=100;n>1?n-=n/t:-1>n?n-=n/t:n=0,r>1?r-=r/t:-1>r?r-=r/t:r=0,s.camera.goTo({x:r,y:n,angle:o+e,ratio:a})}function addNode(e,o,a,r){var n=e.id;if(null==s.graph.nodes(n)){var t=e.properties.ref,d=e.properties.name,i=e.properties.homepage,l=1,g=t,c=n==o?!0:!1,h=c?nodeColorDiscovered:nodeColor,p=!1,u=e.labels[0].toLowerCase(),f="circle";switch(u){case"author":g=d+" ("+t+")",f="circle",p=!showingAuthors;break;case"text":f="square",p=!showingTexts;break;case"thesis":f="diamond",p=!showingTheses}return s.graph.addNode({id:n,name:d,homepage:i,label:g,ref:t,nodeType:u,expanded:c,x:a,y:r,size:l,color:h,hidden:p,type:f}),1}return 0}function addEdge(e){var o=e.id;if(null==s.graph.edges(o)){var a=e.startNode,r=e.endNode,n=e.type;s.graph.addEdge({id:o,source:a,target:r,edgeType:n,label:n,color:edgeColor,type:"arrow",size:2})}}function select(e){e.data.node.id;toggleInfoBox(e)}function toggleEdgeLabels(){$("#edgeLabelToggle").change(function(){edgeLabels()})}function edgeLabels(){$("#edgeLabelToggle").prop("checked")?s.settings("defaultEdgeLabelSize","6"):s.settings("defaultEdgeLabelSize","0"),draw(faConfig2,10)}function toggleInfoBox(e){if(showingInfo=!showingInfo,selectedNode==e.data.node.id||showingInfo||(showingInfo=!0,s.graph.nodes(selectedNode).color=s.graph.nodes(selectedNode).expanded?nodeColorDiscovered:nodeColor),showingInfo){selectedNode=e.data.node.id,e.data.node.color=nodeColorSelected;var o="RePEC Ref: "+e.data.node.ref;switch(o+="<br /> Graph ID: "+e.data.node.id,e.data.node.nodeType){case"Author":o+="<br /> Name: "+e.data.node.name,o+=null!=e.data.node.homepage?"<br /> Homepage: <a href='"+e.data.node.homepage+"'>"+e.data.node.homepage+"</a>":"<br /> Homepage: <em>unavailable</em>";break;case"Text":break;case"Thesis":}e.data.node.expanded?o+="<br /><em>All edges found</em>":(o+="<br /><button class='nodeExpand btn' title='Show more nodes' value='"+e.data.node.id+"'>",o+="<i class='fa fa-plus'></i> Expand </button>"),o="<p>"+o+"</p>",$("#graph2Info").html(o),$("#graph2Info").css("padding",".5em 1em")}else e.data.node.color=e.data.node.expanded?nodeColorDiscovered:nodeColor,selectedNode=null,$("#graph2Info").empty(),$("#graph2Info").css("padding","0em");draw(faConfig2,100),expandFromNode()}function expandFromNode(){$("#graph2Info .nodeExpand").click(function(){var e=$(this).val();drawGraph(e,faConfig,1,!1),$("#graph2Info p").append("<em>All edges found</em>"),$("#graph2Info .nodeExpand").remove()})}function draw(e,o){s.configForceAtlas2(e),s.startForceAtlas2(),setTimeout(function(){s.stopForceAtlas2(),s.killForceAtlas2()},o)}function redraw(){$("#provShuffle").click(function(){redrawGraph()})}function redrawGraph(){selectedNode=null,showingInfo=!1,$("#graph2").empty(),$("#graph2Info").empty(),$("#graph2Info").css("padding","0em"),buildGraph()}function filterListen(){$("form[name=provFilter]").change(function(){showingAuthors=$("input[name=authors]",this).is(":checked"),showingTexts=$("input[name=texts]",this).is(":checked"),showingTheses=$("input[name=theses]",this).is(":checked"),filter()})}function filter(e,o,a){if(graphBuilt){var r=s.graph.nodes();for(var n in r){var t=r[n],d=t.nodeType.toLowerCase();switch(d){case"author":t.hidden=!showingAuthors;break;case"text":t.hidden=!showingTexts;break;case"thesis":t.hidden=!showingTheses}}draw(faConfig2,10)}}var s,zoomMin=.1,zoomMax=1.5,graphBuilt=!1,showingInfo=!1,selectedNode=null,showingAuthors=!0,showingTexts=!0,showingTheses=!0,nodeColor="rgba(42,100,150,.9)",nodeColorSelected="rgba(202,70,66,.9)",nodeColorDiscovered="rgba(25,60,90,.9)",nodeColorDeselect="rgba(42,100,150,.25)",edgeColor="rgba(200,200,200,.9)",edgeDeselectColor="rgba(200,200,200,.25)",edgeInColor="rgba(42,100,150,.75)",edgeOutColor="rgba(202,70,66,.5)";faConfig={barnesHutOptimize:!0,barnesHutTheta:.75,linLogMode:!0,adjustSizes:!1,edgeWeightInfluence:20,scalingRatio:4,strongGravityMode:!0,gravity:1,slowDown:1e3},faConfig2={linLogMode:!1,adjustSizes:!0,edgeWeightInfluence:10,scalingRatio:1,strongGravityMode:!1,gravity:0,slowDown:1e5},faConfig3={barnesHutOptimize:!0,barnesHutTheta:.5,linLogMode:!0,adjustSizes:!0,edgeWeightInfluence:10,scalingRatio:1,strongGravityMode:!0,gravity:1,slowDown:50},$(document).ready(function(){baseURI=$("#meta_uri").html(),buildGraph(),redraw(),filterListen()});