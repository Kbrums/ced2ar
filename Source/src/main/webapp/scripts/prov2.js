function buildGraph(){var e=.7*Math.max(document.documentElement.clientHeight,window.innerHeight||0);document.documentElement.clientHeight<900&&(e=.85*e),$("#graph2").css("height",e+"px"),$("#graph2").css("cursor","move");var o=!1;$("#provShuffle").addClass("disabled");var r={nodes:[],edges:[]},a=new sigma({graph:r,container:"graph2",renderer:{container:document.getElementById("graph2"),type:"canvas"},settings:{doubleClickEnabled:!1,sideMargin:2,zoomMin:zoomMin,zoomMax:zoomMax,minNodeSize:4*(e/475),maxNodeSize:14*(e/450),defaultLabelColor:"#000",defaultLabelHoverColor:"#eee",defaultHoverLabelBGColor:"#333",labelSizeRatio:"1.25",labelThreshold:10,minEdgeSize:0,maxEdgeSize:0}}),t=$("#nodeFilterList :selected").val(),n=$("#filterNode").val(),l=$("#inverted").val(),i=baseURI+"/prov/data2";null!==t&&""!==t?(i+="?roots="+t,null!==l&&""!==l&&(i+="&inverted=true&travelUp=true")):null===n||""===n||graphBuilt?null!==l&&""!==l&&(lastProvS="",i+="?inverted=true"):(o=!0,i+="?roots="+n,null!==l&&""!==l&&(i+="&inverted=true&travelUp=true")),sigma.parsers.json(i,a,function(){var e,r=$("#zoomOn").val(),t=null,l=a.graph.nodes(),i=a.graph.edges(),d=l.length;for(e=0;e<i.length;e++)edge=i[e],edge.color="#ccc",edge.type="curvedArrow",edge.size=2;for(e=0;d>e;e++){var s=l[e];s.x=Math.random(),s.y=Math.random();var c=a.graph.degree(s.id,"out"),u=a.graph.degree(s.id,"in");switch(s.nodeType){case 0:s.type="circle";break;case"0":s.type="circle";break;case 1:s.type="square";break;case"1":s.type="square";break;case 2:s.type="diamond";break;case"2":s.type="diamond"}"true"===s.isCodebook&&(s.type="equilateral",s.label+=" (codebook)"),s.size=3*c,""!==r&&s.id==r?(t=s,s.color="#F00"):null===s.uri?s.color=nodeNullURIColor:0===u&&0===c?s.color=nodeDisconnectColor:s.color=nodeColor,$("#nodeFilterList option[value='"+s.id+"']").length<1&&$("#nodeFilterList").append('<option value="'+s.id+'">'+s.label+"</option>")}o&&$("#nodeFilterList option[value='"+n+"']").prop("selected",!0),$("#graph2 h2").remove(),a.refresh(),faConfig={barnesHutOptimize:!0,barnesHutTheta:.5,linLogMode:!1,adjustSizes:!1,edgeWeightInfluence:10,scalingRatio:1,strongGravityMode:!0,gravity:0,slowDown:100},faConfig2={linLogMode:!1,adjustSizes:!0,edgeWeightInfluence:10,scalingRatio:1,strongGravityMode:!1,gravity:0,slowDown:1e5},a.configForceAtlas2(faConfig),a.startForceAtlas2(),setTimeout(function(){graphBuilt=!0,a.stopForceAtlas2(),a.killForceAtlas2(),null!==t&&(moveToNode(a,t),$("#zoomOn").val("")),$("#provShuffle").removeClass("disabled"),a.bind("overNode outNode",function(e){"overNode"===e.type?$("#graph2").css("cursor","pointer"):$("#graph2").css("cursor","move")});var e;a.bind("clickNode",function(o){e=select(a,o)});var o,r=!1;$(document).keydown(function(e){81!=e.keyCode||r||(r=!0,o=setInterval(function(){rotate(a,.01)},5))}).keyup(function(){clearInterval(o),o=null,r=!1});var n;$(document).keydown(function(e){69!=e.keyCode||r||(r=!0,n=setInterval(function(){rotate(a,-.01)},5))}).keyup(function(){clearInterval(n),n=null,r=!1})},750)})}function shuffle(){$("#provShuffle").click(function(){$("#graph2").empty(),$("#graph2Info").empty(),$("#graph2Info").css("padding","0em"),buildGraph()})}function rotate(e,o){var r=e.camera.angle,a=e.camera.ratio,t=e.camera.x,n=e.camera.y,l=100;n>1?n-=n/l:-1>n?n-=n/l:n=0,t>1?t-=t/l:-1>t?t-=t/l:t=0,e.camera.goTo({x:t,y:n,angle:r+o,ratio:a})}function moveToNode(e,o){e.camera.goTo({x:o["read_cam0:x"],y:o["read_cam0:y"]})}function select(e,o){viewingSubset=!viewingSubset;var r=e.graph.nodes(),a=e.graph.edges(),t=o.data.node.id;selectedNode!=o.data.node.id&&null!==selectedNode&&(viewingSubset=!0,resetGraph(e));var n=viewingSubset,l=[],d=0,s=0;if(l.push(t),n){for(selectedNode=t,o.data.node.color=selectColor,i=0;i<a.length;i++){var c=a[i];c.source===t||c.target===t?(c.source===t&&(s++,l.push(c.target),c.color=outColor),c.target===t&&(d++,l.push(c.source),c.color=inColor),c.target==c.source&&(c.color=srColor)):c.color="transparent"}for(i=0;i<r.length;i++){var u=r[i];-1==l.indexOf(u.id)&&(u.hidden=!0)}var g="ID: "+o.data.node.id;g+="<br /> Label: "+o.data.node.label;var p="";if(null!==o.data.node.uri){var h=o.data.node.uri;p="URI: <a href='"+h+"' target='_blank'>"+h+"</a>"}else p="URI: none";g+="<br />"+p,g+="<br /><a href='"+baseURI+"/edit/prov/"+o.data.node.id+"'>Edit this node</a>",g="<p>"+g+"</p>",$("#graph2Info").html(g),$("#graph2Info").css("padding",".5em 1em")}else selectedNode=null,o.data.node.color=nodeColor,resetGraph(e);var v=faConfig2,f=1e3;return e.configForceAtlas2(v),e.startForceAtlas2(),setTimeout(function(){e.stopForceAtlas2(),e.killForceAtlas2()},f),n?o:null}function resetGraph(e){var o=e.graph.nodes(),r=e.graph.edges();for(i=0;i<r.length;i++)r[i].color=edgeColor;for(i=0;i<o.length;i++){var a=o[i],t=e.graph.degree(a.id,"out"),n=e.graph.degree(a.id,"in");a.hidden=!1,null===a.uri?a.color=nodeNullURIColor:0===n&&0===t?a.color=nodeDisconnectColor:a.color=nodeColor}$("#graph2Info").empty(),$("#graph2Info").css("padding","0em")}var viewingSubset=!1,selectedNode=null,zoomMin=.1,zoomMax=1.5,selectColor="#4282ca",nodeColor="#2a6496",nodeNullURIColor="#333",nodeDisconnectColor="rgba(42,100,150,.25)",edgeColor="#ccc",outColor="#d91616",inColor="#00d093",srColor="#d97816";$(document).ready(function(){$("#graph2").html("<h2>Loading...</h2>"),graphBuilt=!1,lastProvS="",baseURI=$("#meta_uri").html(),buildGraph(),shuffle()});